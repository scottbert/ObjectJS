<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*jslint bitwise: false, browser: true, windows: false, evil: false, white: false, plusplus: true */
/*globals ObjectJS:false,$:false, TestCase:false,assertEquals:false,expectAsserts:false,assertFunction:false,assertNoException:false, ActiveXObject:false*/
<span id='global-property-'>/**
</span> * @author scottvanlooy
 */
ObjectJS.reqNameSpace('ObjectJS.extras.mixins');
(function (mixins) {
	&quot;use strict&quot;;
	var augment,
		OBJMIXINS,
		UIMIXINS,
		that,
		dataObj = {},
		eventBind,
		eventPrefix,
		getAttr = function (str, attr) {
			return (str.split(new RegExp('\\b' + attr + '='))[1] || '').split('&amp;')[0];
		},
		hijack = function (callback) {
			return function (e) {
				if (!e || !e.stopPropagation) {
					e = {
						stopPropagation : window.event.cancelBubble,
						preventDefault : function () {
							window.event.returnValue = false;
						}
					};
				}
				callback(e);
			};
		},
		NativeUI = function (object) {
			var i;
			for (i in OBJMIXINS) {
				if (OBJMIXINS.hasOwnProperty(i)) {
					object[i] = OBJMIXINS[i];
				}
			}
		},
		NativeSelector = function (id) {
			if (!document.querySelectorAll) {
				throw ('Old browser, please use jQuery mixin');
			}
			var Node;
			// If we're an ID, get us. getElementById is faster than querySelectorAll - 
			// this currently works about 10 times faster than jQuery for single IDs and 
			// nearly twice as fast for more complex queries.
			if (id.charAt(0).indexOf('#') === -1 &amp;&amp; id.indexOf(' ') === -1) {
				Node = document.getElementById(id);
			} else {
				Node = document.querySelectorAll(id);
			}
			augment(Node);
			return Node;
		},
		NativeController = function (Controller) {
			Controller.createXHR = function () {
				var xhr,
					XHR = {};
				if (window.XMLHttpRequest) {
					xhr = new window.XMLHttpRequest();
				} else if (window.ActiveXObject) {
					xhr = new ActiveXObject('MSXML2.XMLHTTP.3.0');
				} else {
					return null;
				}
				XHR.open = function (url, callback, error) {

				};
				XHR.error = function () {

				};
				return XHR;
			};
			Controller.createJSONP = function (cbname) {
				var fn = cbname || 'f' + (new Date().getTime()).toString(16),
					JSONP = {};
				JSONP.open = function (url, callback, error) {
					var c,
						n = 0,
						t,
						cb = function () {
							if (callback) {
								if (c &gt; 10000) {
									if (error) {
										error('Didn\'t get any data after 10s, check ?callback');
									}
								}
								if (typeof dataObj[fn] !== &quot;undefined&quot;) {
									callback(dataObj[fn]);
								} else {
									setTimeout(cb, 100);
								}
							}
						};
					t = getAttr(url, 'callback');
					if (t) {
						fn = t;
					} else {
						c = '?callback';
						if (url.indexOf('?') !== -1) {
							c = '&amp;callback';
						}
						url += c + '=' + fn;
					}
					window[fn] = function (data) {
						dataObj[fn] = data;
					};
					try {
						ObjectJS.loadScript(url, cb, 1, 0, 0, error);
					} catch (ex) {
						error(ex);
					}
				};
				JSONP.error = function () {
					//something
				};
				return JSONP;
			};
		};
	augment = function (Nodes) {
		var i;
		if (!Nodes.augmented) {
			for (i in UIMIXINS) {
				if (UIMIXINS.hasOwnProperty(i)) {
					Nodes[i] = UIMIXINS[i];
				}
			}
			Nodes.augmented = true;
		}
		return Nodes;
	};
	OBJMIXINS = {
		superOpen: function (callback) {
			that = that || this;
			that.domNode.style.display = 'block';
			return (callback) ? callback() : null;
		},
		superClose: function (callback) {
			that = that || this;
			that.domNode.style.display = 'none';
			return (callback) ? callback() : null;
		},
		on: function () {
			that = that || this;
			that.domNode.style.display = 'block';
		},
		off: function () {
			that = that || this;
			that.domNode.style.display = 'none';
		}
	};
	UIMIXINS = {
		find: function (str) {
			return augment(this.querySelectorAll(str));
		},
		remove: function () {
			var NodeList = this,
				ret = [],
				l = NodeList.length,
				n;
			if (!NodeList.item) {
				NodeList = [NodeList];
			}
			for (n = 0; n &lt; l; n++) {
				ret.push(augment(NodeList[n].parentNode.removeChild(NodeList[n])));
			}
			return ret;
		},
		bind : function (str, func) {
			var NodeList = this,
				ret = [],
				l = NodeList.length,
				n;
			if (!NodeList.item) {
				NodeList = [NodeList];
			}
			if (!eventBind) {
				if (NodeList[0].addEventListener) {
					eventBind = 'addEventListener';
					eventPrefix = '';
				} else {
					eventBind = 'attachEvent';
					eventPrefix = 'on';
				}
			}
			for (n = 0; n &lt; l; n++) {
				if (NodeList[n][eventBind]) {
					NodeList[n][eventBind](eventPrefix + str, hijack(func), true);
				}
				ret.push(augment(NodeList[n]));
			}
			return ret;
		},
		addClass : function (classNames) {
			function p(o, c) {
				var e = o || '',
					ca,
					pa,
					l,
					ia = false,
					pia = (e.indexOf(' ') !== -1),
					cia = (c.indexOf(' ') !== -1),
					cs;
				if (pia || cia) {
					if (pia &amp;&amp; cia) {
						return ObjectJS.core.utils.ArrayUtils.combine(e.split(' '), c.split(' ')).join(' ');
					}
					pa = (pia) ? e.split(' ') : c.split(' ');
					cs = (pia) ? c : e;
					l = pa.length;
					while (l--) {
						if (pa[l] === cs) {
							ia = true;
						}
					}
					if (!ia &amp;&amp; cs !== '') {
						pa.push((cs.trim) ? cs.trim() : cs);
					}
					return pa.join(' ');
				}
				return (e === '') ? c : e + ' ' + c;
			}
			// more than one class
			if (this.length) {
				var l = this.length;
				while (l--) {
					this[l].setAttribute('class', p(this[l].getAttribute('class'), classNames));
				}
			} else {
				this.setAttribute('class', p(this.getAttribute('class'), classNames));
			}
		},
		removeClass : function (classNames) {
			var l = this.length;
			function d(o, s) {
				o.setAttribute('class', (s.trim) ? o.getAttribute('class').replace(s, '').trim() : o.getAttribute('class').replace(s, ''));
			}
			function m(o, cn) {
				var ca = cn.split(' '),
					cl = ca.length;
				if (cl) {
					while (cl--) {
						d(o, ca[cl]);
					}
				} else {
					d(o, cn);
				}
			}
			if (l) {
				while (l--) {
					m(this[l], classNames);
				}
			} else {
				m(this, classNames);
			}
		}
	};
	mixins.NativeUI = NativeUI;
	mixins.NativeSelector = NativeSelector;
	mixins.NativeController = NativeController;
}(ObjectJS.extras.mixins));
ObjectJS.mixins.UI = ObjectJS.extras.mixins.NativeUI;
ObjectJS.mixins.Selector = ObjectJS.extras.mixins.NativeSelector;
ObjectJS.mixins.Controller = ObjectJS.extras.mixins.NativeController;</pre>
</body>
</html>
