<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*jslint bitwise: false, browser: true, windows: false, evil: false, white: false, plusplus: true */
/*globals ObjectJS:false,$:false, TestCase:false,assertEquals:false,expectAsserts:false,assertFunction:false,assertNoException:false*/
<span id='global-property-'>/**
</span> * @author scottvanlooy
 */
ObjectJS.reqNameSpace('ObjectJS');
(function (Oj) {
	&quot;use strict&quot;;
<span id='global-property-E'>	/**
</span>	 * the Events object store.
	 * @type {Object}
	 */
	var E = {},
<span id='global-property-'>	/**
</span>	 * the Events registry, where we keep all our registered custom events.
	 * @type {Object}
	 */
		Registry = {
			&quot;GET_DATA&quot; : 'onGetData',
			&quot;GOT_DATA&quot; : 'onGotData'
		},
<span id='global-property-'>		/**
</span>		 * the Events object - contains our methods for adding, removing, subscribing to and publishing custom framework events.
		 * @type {Object}
		 */
		Events = {
<span id='global-method-subscribe'>			/**
</span>			 * Subscribe an object to some events. Pass this function a FractalJS object with methods that
			 * match methods in the registry and they will be added as event listeners to the events system.
			 * @param  {Object} Object	this is the FractalJS object you wish to listen to specific events.
			 * @return {null}			Does not return anything.
			 */
			subscribe : function (Object) {
				var customEvent;
				for (customEvent in Registry) {
					if (Registry.hasOwnProperty(customEvent)) {
						if (typeof Object[Registry[customEvent]] === &quot;function&quot;) {
							if (!E[customEvent]) {
								E[customEvent] = [];
							}
							E[customEvent].push({
								id : Object.id,
								fn : Object[Registry[customEvent]],
								view: Object.getView()
							});
						}
					}
				}
			},
<span id='global-method-unsubscribe'>			/**
</span>			 * Allows us to manually remove an object's event listeners, for instance if
			 * we destroy an object.
			 * @param  {Object} Object	the FractalJS object we want to remove from the events system
			 * listener list.
			 * @return {null}			Does not return anything.
			 */
			unsubscribe : function (Object) {
				var customEvent,
					l;
				for (customEvent in E) {
					if (E.hasOwnProperty(customEvent)) {
						l = E[customEvent].length;
						while (l--) {
							if (E[customEvent][l].id === Object.id) {
								E[customEvent].splice(l, 1);
							}
						}
					}
				}
			},
<span id='global-method-publish'>			/**
</span>			 * This publishes an event.
			 * @param  {string} eventKey	The key for the event we would like to publish
			 * @param  {object} parameters  Any parameters passed to the event.
			 * @param  {string} view        Optionally pass a view's ID to only publish 
			 * @return {array | object}		an optional argument or array of arguments.
			 */
			publish : function (eventKey, parameters, view) {
				var functions,
					l,
					x;
				if (Registry[eventKey]) {
					functions = E[eventKey];
					if (functions) {
						l = functions.length;
						for (x = 0; x &lt; l; x++) {
							if (view &amp;&amp; view === functions[x].view.id) {
								functions[x].fn(parameters || null);
							} else {
								functions[x].fn(parameters || null);
							}
						}
					}
				}
			},
<span id='global-method-add'>			/**
</span>			 * Adds events to registry. Takes an event object consisting of one or more events key value pairs, for example:
			 * {
			 *    &quot;EVENT_FOO&quot; : &quot;onFoo&quot;
			 * }
			 * @param {Object} eventKeys An object of strings.
			 */
			add : function (eventKeys) {
				var customEvent;
				for (customEvent in eventKeys) {
					if (eventKeys.hasOwnProperty(customEvent)) {
						Registry[customEvent] = eventKeys[customEvent];
					}
				}
			},
<span id='global-method-hasEvent'>			/**
</span>			 * Test to see if we have an event key for the specified event
			 * @param {string} key the key to test for.
			 * @return {Boolean} returns true or false.
			 */
			hasEvent : function (key) {
				return (Registry[key]) ? true : false;
			},
<span id='global-method-remove'>			/**
</span>			 * Remove events from registry
			 * @param {arguments} arguments list of keys to be removed from the event registry
			 * @return {[type]} [description]
			 */
			remove : function () {
				var l = arguments.length;
				while (l--) {
					if (Registry[arguments[l]]) {
						delete Registry[arguments[l]];
					}
				}
			}
		};
	Oj.Events = Events;
}(ObjectJS));</pre>
</body>
</html>
